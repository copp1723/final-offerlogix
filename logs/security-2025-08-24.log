{"timestamp":"2025-08-24 13:17:26.219","level":"error","message":"Failed to check email suppression","correlationId":"no-correlation","service":"mailmind-api","environment":"development","email":"josh@atsglobal.ai","clientId":null,"error":{"length":161,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"bool.c","line":"151","routine":"boolin"},"errorName":"error","errorMessage":"invalid input syntax for type boolean: \"[object Object] OR [object Object]\"","stackTrace":"error: invalid input syntax for type boolean: \"[object Object] OR [object Object]\"\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async <anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/src/node-postgres/session.ts:104:19)\n    at async isEmailSuppressed (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:384:26)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:196:26)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)"}
{"timestamp":"2025-08-24 13:17:26.932","level":"error","message":"Failed to queue email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{"length":139,"name":"error","severity":"ERROR","code":"42703","position":"44","file":"parse_target.c","line":"1066","routine":"checkInsertTargets"},"errorName":"error","errorMessage":"column \"idempotency_key\" of relation \"email_queue\" does not exist","stackTrace":"error: column \"idempotency_key\" of relation \"email_queue\" does not exist\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async <anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/src/node-postgres/session.ts:104:19)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:229:27)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)"}
{"timestamp":"2025-08-24 13:17:26.932","level":"error","message":"Failed to send reliable campaign email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{"length":139,"name":"error","severity":"ERROR","code":"42703","position":"44","file":"parse_target.c","line":"1066","routine":"checkInsertTargets"},"errorName":"error","errorMessage":"column \"idempotency_key\" of relation \"email_queue\" does not exist","stackTrace":"error: column \"idempotency_key\" of relation \"email_queue\" does not exist\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async <anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/src/node-postgres/session.ts:104:19)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:229:27)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)"}
{"timestamp":"2025-08-24 13:19:18.997","level":"error","message":"Failed to check email suppression","correlationId":"no-correlation","service":"mailmind-api","environment":"development","email":"josh@atsglobal.ai","clientId":null,"error":{},"errorName":"ReferenceError","errorMessage":"gte is not defined","stackTrace":"ReferenceError: gte is not defined\n    at isEmailSuppressed (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:375:9)\n    at queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:196:32)\n    at sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:27)\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)\n    at async ExecutionProcessor.processEmailSequence (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:102:30)"}
{"timestamp":"2025-08-24 13:19:19.236","level":"error","message":"Failed to queue email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{"length":136,"name":"error","severity":"ERROR","code":"42703","position":"197","file":"parse_target.c","line":"1066","routine":"checkInsertTargets"},"errorName":"error","errorMessage":"column \"next_run_at\" of relation \"email_queue\" does not exist","stackTrace":"error: column \"next_run_at\" of relation \"email_queue\" does not exist\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async <anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/src/node-postgres/session.ts:104:19)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:229:27)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)"}
{"timestamp":"2025-08-24 13:19:19.236","level":"error","message":"Failed to send reliable campaign email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{"length":136,"name":"error","severity":"ERROR","code":"42703","position":"197","file":"parse_target.c","line":"1066","routine":"checkInsertTargets"},"errorName":"error","errorMessage":"column \"next_run_at\" of relation \"email_queue\" does not exist","stackTrace":"error: column \"next_run_at\" of relation \"email_queue\" does not exist\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async <anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/src/node-postgres/session.ts:104:19)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:229:27)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)"}
{"timestamp":"2025-08-24 13:20:15.343","level":"error","message":"Failed to check email suppression","correlationId":"no-correlation","service":"mailmind-api","environment":"development","email":"josh@atsglobal.ai","clientId":null,"error":{"length":161,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"bool.c","line":"151","routine":"boolin"},"errorName":"error","errorMessage":"invalid input syntax for type boolean: \"[object Object] OR [object Object]\"","stackTrace":"error: invalid input syntax for type boolean: \"[object Object] OR [object Object]\"\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async <anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/src/node-postgres/session.ts:104:19)\n    at async isEmailSuppressed (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:384:26)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:196:26)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)"}
{"timestamp":"2025-08-24 13:20:16.918","level":"error","message":"Failed to queue email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{},"errorName":"MaxRetriesPerRequestError","errorMessage":"Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.","stackTrace":"MaxRetriesPerRequestError: Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.\n    at Socket.<anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/ioredis/built/redis/event_handler.js:182:37)\n    at Object.onceWrapper (node:events:622:26)\n    at Socket.emit (node:events:507:28)\n    at TCP.<anonymous> (node:net:346:12)"}
{"timestamp":"2025-08-24 13:20:16.919","level":"error","message":"Failed to send reliable campaign email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{},"errorName":"MaxRetriesPerRequestError","errorMessage":"Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.","stackTrace":"MaxRetriesPerRequestError: Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.\n    at Socket.<anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/ioredis/built/redis/event_handler.js:182:37)\n    at Object.onceWrapper (node:events:622:26)\n    at Socket.emit (node:events:507:28)\n    at TCP.<anonymous> (node:net:346:12)"}
{"timestamp":"2025-08-24 13:22:53.229","level":"error","message":"Failed to check email suppression","correlationId":"no-correlation","service":"mailmind-api","environment":"development","email":"josh@atsglobal.ai","clientId":null,"error":{"length":161,"name":"error","severity":"ERROR","code":"22P02","where":"unnamed portal parameter $2 = '...'","file":"bool.c","line":"151","routine":"boolin"},"errorName":"error","errorMessage":"invalid input syntax for type boolean: \"[object Object] OR [object Object]\"","stackTrace":"error: invalid input syntax for type boolean: \"[object Object] OR [object Object]\"\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async <anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/src/node-postgres/session.ts:104:19)\n    at async isEmailSuppressed (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:383:26)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:196:26)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)"}
{"timestamp":"2025-08-24 13:22:54.821","level":"error","message":"Failed to queue email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{},"errorName":"MaxRetriesPerRequestError","errorMessage":"Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.","stackTrace":"MaxRetriesPerRequestError: Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.\n    at Socket.<anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/ioredis/built/redis/event_handler.js:182:37)\n    at Object.onceWrapper (node:events:622:26)\n    at Socket.emit (node:events:507:28)\n    at TCP.<anonymous> (node:net:346:12)"}
{"timestamp":"2025-08-24 13:22:54.822","level":"error","message":"Failed to send reliable campaign email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{},"errorName":"MaxRetriesPerRequestError","errorMessage":"Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.","stackTrace":"MaxRetriesPerRequestError: Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.\n    at Socket.<anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/ioredis/built/redis/event_handler.js:182:37)\n    at Object.onceWrapper (node:events:622:26)\n    at Socket.emit (node:events:507:28)\n    at TCP.<anonymous> (node:net:346:12)"}
{"timestamp":"2025-08-24 13:25:33.619","level":"error","message":"Failed to queue email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{},"errorName":"MaxRetriesPerRequestError","errorMessage":"Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.","stackTrace":"MaxRetriesPerRequestError: Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.\n    at Socket.<anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/ioredis/built/redis/event_handler.js:182:37)\n    at Object.onceWrapper (node:events:622:26)\n    at Socket.emit (node:events:507:28)\n    at TCP.<anonymous> (node:net:346:12)"}
{"timestamp":"2025-08-24 13:25:33.620","level":"error","message":"Failed to send reliable campaign email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{},"errorName":"MaxRetriesPerRequestError","errorMessage":"Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.","stackTrace":"MaxRetriesPerRequestError: Reached the max retries per request limit (which is 3). Refer to \"maxRetriesPerRequest\" option for details.\n    at Socket.<anonymous> (/Users/joshcopp/Desktop/MailMind/node_modules/ioredis/built/redis/event_handler.js:182:37)\n    at Object.onceWrapper (node:events:622:26)\n    at Socket.emit (node:events:507:28)\n    at TCP.<anonymous> (node:net:346:12)"}
{"timestamp":"2025-08-24 13:28:15.320","level":"error","message":"Direct email send failed","correlationId":"no-correlation","service":"mailmind-api","environment":"development","queueId":"a9b80783-897f-45a4-89ba-b3b0bd6b9ff2","to":"josh@atsglobal.ai","error":{},"errorName":"TypeError","errorMessage":"sendEmail is not a function","stackTrace":"TypeError: sendEmail is not a function\n    at queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:250:28)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)\n    at async ExecutionProcessor.processEmailSequence (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:102:30)\n    at async CampaignScheduler.executeCampaign (/Users/joshcopp/Desktop/MailMind/server/services/campaign-scheduler.ts:254:22)\n    at async testCampaignExecution (/Users/joshcopp/Desktop/MailMind/test-campaign-execution.js:61:29)"}
{"timestamp":"2025-08-24 13:28:15.321","level":"error","message":"Failed to queue email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{},"errorName":"TypeError","errorMessage":"sendEmail is not a function","stackTrace":"TypeError: sendEmail is not a function\n    at queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:250:28)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)\n    at async ExecutionProcessor.processEmailSequence (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:102:30)\n    at async CampaignScheduler.executeCampaign (/Users/joshcopp/Desktop/MailMind/server/services/campaign-scheduler.ts:254:22)\n    at async testCampaignExecution (/Users/joshcopp/Desktop/MailMind/test-campaign-execution.js:61:29)"}
{"timestamp":"2025-08-24 13:28:15.321","level":"error","message":"Failed to send reliable campaign email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{},"errorName":"TypeError","errorMessage":"sendEmail is not a function","stackTrace":"TypeError: sendEmail is not a function\n    at queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:250:28)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)\n    at async ExecutionProcessor.processEmailSequence (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:102:30)\n    at async CampaignScheduler.executeCampaign (/Users/joshcopp/Desktop/MailMind/server/services/campaign-scheduler.ts:254:22)\n    at async testCampaignExecution (/Users/joshcopp/Desktop/MailMind/test-campaign-execution.js:61:29)"}
{"timestamp":"2025-08-24 13:30:41.288","level":"info","message":"Email sent directly via Mailgun","correlationId":"no-correlation","service":"mailmind-api","environment":"development","queueId":"5b1bcd42-3cd1-4d5f-b20c-8d6fcf84c93d","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","mailgunResult":{"success":true,"messageId":"<20250824183041.4e5c2da7c975f5d2@mg.watchdogai.us>","riskScore":0,"validationResult":{"isValid":true,"riskLevel":"low"}}}
{"timestamp":"2025-08-24 13:30:41.289","level":"info","message":"Campaign email queued successfully","correlationId":"no-correlation","service":"mailmind-api","environment":"development","queueId":"5b1bcd42-3cd1-4d5f-b20c-8d6fcf84c93d","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","priority":1}
{"timestamp":"2025-08-24 15:09:47.220","level":"error","message":"Failed to queue email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{"length":231,"name":"error","severity":"ERROR","code":"23505","detail":"Key (job_id)=(direct-send-failed) already exists.","schema":"public","table":"email_queue","constraint":"email_queue_job_id_key","file":"nbtinsert.c","line":"666","routine":"_bt_check_unique"},"errorName":"error","errorMessage":"duplicate key value violates unique constraint \"email_queue_job_id_key\"","stackTrace":"error: duplicate key value violates unique constraint \"email_queue_job_id_key\"\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:277:7)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)\n    at async ExecutionProcessor.processEmailSequence (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:102:30)"}
{"timestamp":"2025-08-24 15:09:47.221","level":"error","message":"Failed to send reliable campaign email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{"length":231,"name":"error","severity":"ERROR","code":"23505","detail":"Key (job_id)=(direct-send-failed) already exists.","schema":"public","table":"email_queue","constraint":"email_queue_job_id_key","file":"nbtinsert.c","line":"666","routine":"_bt_check_unique"},"errorName":"error","errorMessage":"duplicate key value violates unique constraint \"email_queue_job_id_key\"","stackTrace":"error: duplicate key value violates unique constraint \"email_queue_job_id_key\"\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:277:7)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)\n    at async ExecutionProcessor.processEmailSequence (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:102:30)"}
{"timestamp":"2025-08-24 17:31:52.371","level":"error","message":"Failed to queue email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{"length":231,"name":"error","severity":"ERROR","code":"23505","detail":"Key (job_id)=(direct-send-failed) already exists.","schema":"public","table":"email_queue","constraint":"email_queue_job_id_key","file":"nbtinsert.c","line":"666","routine":"_bt_check_unique"},"errorName":"error","errorMessage":"duplicate key value violates unique constraint \"email_queue_job_id_key\"","stackTrace":"error: duplicate key value violates unique constraint \"email_queue_job_id_key\"\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:277:7)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)\n    at async ExecutionProcessor.processEmailSequence (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:102:30)"}
{"timestamp":"2025-08-24 17:31:52.372","level":"error","message":"Failed to send reliable campaign email","correlationId":"no-correlation","service":"mailmind-api","environment":"development","to":"josh@atsglobal.ai","campaignId":"ccc9d43b-cf58-49f1-89e1-2fc366468dac","leadId":"eae6bc8b-46d0-46e0-a585-e268fab4304c","error":{"length":231,"name":"error","severity":"ERROR","code":"23505","detail":"Key (job_id)=(direct-send-failed) already exists.","schema":"public","table":"email_queue","constraint":"email_queue_job_id_key","file":"nbtinsert.c","line":"666","routine":"_bt_check_unique"},"errorName":"error","errorMessage":"duplicate key value violates unique constraint \"email_queue_job_id_key\"","stackTrace":"error: duplicate key value violates unique constraint \"email_queue_job_id_key\"\n    at /Users/joshcopp/Desktop/MailMind/node_modules/pg-pool/index.js:45:11\n    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)\n    at async queueEmail (/Users/joshcopp/Desktop/MailMind/server/services/email-queue.ts:277:7)\n    at async sendReliableCampaignEmail (/Users/joshcopp/Desktop/MailMind/server/services/reliable-email-service.ts:82:21)\n    at async ExecutionProcessor.sendWithReliability (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:338:22)\n    at async ExecutionProcessor.sendEmailToLead (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:213:23)\n    at async runWorker (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:274:30)\n    at async Promise.all (index 0)\n    at async ExecutionProcessor.runWithConcurrency (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:285:5)\n    at async ExecutionProcessor.processEmailSequence (/Users/joshcopp/Desktop/MailMind/server/services/campaign-execution/ExecutionProcessor.ts:102:30)"}
{"timestamp":"2025-08-24 23:48:13.267","level":"error","message":"Failed to create campaign in database","correlationId":"no-correlation","service":"mailmind-api","environment":"production","error":"column \"lead_score_weights\" of relation \"campaigns\" does not exist","campaignName":"E2E Test Campaign - Car Sales","hasTemplates":true,"templatesCount":0,"hasHandoverCriteria":false,"sqlState":"42703"}
